<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Profil Saya - Riuhin</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: auto; background: #f5f8fa; padding: 20px; }
    h2 { color: #1da1f2; }
    .profile-header { display: flex; justify-content: space-between; align-items: center; }
    .btn { padding: 6px 12px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
    .btnLogout { background: red; color: white; }
    .btnEdit { background: orange; color: white; }
    .postForm textarea { width: 100%; padding: 10px; margin: 10px 0; }
    .postForm button { background: #1da1f2; color: white; }
    .post { background: white; padding: 10px; margin: 10px 0; border-radius: 8px; }
    .btnDelete { background: crimson; color: white; margin-top: 5px; }
  </style>
</head>
<body>
  <div class="profile-header">
    <h2 id="usernameDisplay"></h2>
    <div>
      <button class="btn btnEdit" onclick="editProfil()">Edit Profil</button>
      <button class="btn btnLogout" onclick="logout()">Logout</button>
    </div>
  </div>
  <p><span id="followersCount">0</span> followers</p>

  <div class="postForm">
    <h3>Buat Postingan</h3>
    <textarea id="postContent" placeholder="Apa yang kamu pikirkan?" required></textarea>
    <button class="btn" onclick="buatPosting()">Posting</button>
  </div>

  <h3>Postingan Saya</h3>
  <div id="myPosts"></div>

  <script>
    let currentUser = JSON.parse(localStorage.getItem("currentUser"));
    if (!currentUser) {
      alert("Anda belum login!");
      window.location.href = "login.html";
    }

    function loadProfile() {
      document.getElementById("usernameDisplay").innerText = currentUser.username;
      document.getElementById("followersCount").innerText = currentUser.followers ? currentUser.followers.length : 0;
      tampilkanPostingan();
    }

    function buatPosting() {
      const content = document.getElementById("postContent").value.trim();
      if (!content) return alert("Tuliskan sesuatu dulu!");

      let posts = JSON.parse(localStorage.getItem("posts")) || [];
      posts.push({
        email: currentUser.email,
        username: currentUser.username,
        content: content,
        timestamp: new Date().toLocaleString()
      });
      localStorage.setItem("posts", JSON.stringify(posts));
      document.getElementById("postContent").value = "";
      tampilkanPostingan();
    }

    function tampilkanPostingan() {
      const posts = JSON.parse(localStorage.getItem("posts")) || [];
      const myPosts = posts.filter(p => p.email === currentUser.email).reverse();

      const container = document.getElementById("myPosts");
      container.innerHTML = "";
      myPosts.forEach((post, index) => {
        const div = document.createElement("div");
        div.className = "post";
        div.innerHTML = `
          <p>${post.content}</p>
          <small>${post.timestamp}</small><br>
          <button class="btnDelete" onclick="hapusPosting(${index})">Hapus</button>
        `;
        container.appendChild(div);
      });
    }

    function hapusPosting(index) {
      let posts = JSON.parse(localStorage.getItem("posts")) || [];
      let myPosts = posts.filter(p => p.email === currentUser.email);
      let postToDelete = myPosts[index];

      posts = posts.filter(p => !(p.email === postToDelete.email && p.timestamp === postToDelete.timestamp));
      localStorage.setItem("posts", JSON.stringify(posts));
      tampilkanPostingan();
    }

    function editProfil() {
      const newUsername = prompt("Masukkan username baru (max 15 huruf):", currentUser.username);
      if (newUsername && newUsername.length <= 15) {
        currentUser.username = newUsername;
      }
      const newPassword = prompt("Masukkan password baru (min 6 huruf):", currentUser.password);
      if (newPassword && newPassword.length >= 6) {
        currentUser.password = newPassword;
      }
      localStorage.setItem(currentUser.email, JSON.stringify(currentUser));
      localStorage.setItem("currentUser", JSON.stringify(currentUser));
      loadProfile();
    }

    function logout() {
      localStorage.removeItem("currentUser");
      window.location.href = "login.html";
    }

    loadProfile();
  </script>
</body>
</html>
</html>